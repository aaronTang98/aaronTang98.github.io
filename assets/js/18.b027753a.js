(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{524:function(s,a,e){"use strict";e.r(a);var r=e(6),t=Object(r.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"k3s-介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k3s-介绍"}},[s._v("#")]),s._v(" k3s 介绍")]),s._v(" "),e("p",[s._v("大家开始寻求k8s 的轻量化，k3s 应运而生。k3s 是微型k8s发行版。")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("1.CNCF认证的Kubernetes发行版")])]),s._v(" "),e("li",[e("p",[s._v("2.50MB左右二进制包，500MB左右内存消耗")])]),s._v(" "),e("li",[e("p",[s._v("3.单一进程包含Kubernetes master, Kubelet, 和 containerd")])]),s._v(" "),e("li",[e("p",[s._v("4.支持SQLite/Mysql/PostgreSQL/DQlite和etcd")])]),s._v(" "),e("li",[e("p",[s._v("5.同时为x86_64, Arm64, 和 Armv7 平台发布\n")])])]),s._v(" "),e("h2",{attrs:{id:"k8s-的特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s-的特点"}},[s._v("#")]),s._v(" k8s 的特点")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("单进程架构简化部署")])]),s._v(" "),e("li",[e("p",[s._v("移除各种非必须代码，减小资源占用")])]),s._v(" "),e("li",[e("p",[s._v("TLS证书管理")])]),s._v(" "),e("li",[e("p",[s._v("内置Containerd")])]),s._v(" "),e("li",[e("p",[s._v("内置自运行rootfs")])]),s._v(" "),e("li",[e("p",[s._v("内置Helm Chart管理机制")])]),s._v(" "),e("li",[e("p",[s._v("内置L4/L7 LB支持")])]),s._v(" "),e("li",[e("p",[s._v("...")])])]),s._v(" "),e("h2",{attrs:{id:"k8s-架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s-架构"}},[s._v("#")]),s._v(" k8s 架构")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/k3s01.png",alt:"k3s01"}})]),s._v(" "),e("p",[s._v("主要分为k3s Server 端，其他为k3s Angent 端。")]),s._v(" "),e("p",[s._v("server节点被定义为运行k3s server命令的主机（裸机或虚拟机）。worker节点被定义为运行k3s agent命令的主机。")]),s._v(" "),e("h3",{attrs:{id:"具有嵌入式数据库的单server架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#具有嵌入式数据库的单server架构"}},[s._v("#")]),s._v(" 具有嵌入式数据库的单server架构")]),s._v(" "),e("p",[s._v("下图展示了一个单server集群示例，该集群具有带嵌入式SQLite数据库的单节点K3s server。")]),s._v(" "),e("p",[s._v("在此架构中，每个worker节点都注册到同一个server节点，K3s用户可以通过在server节点上调用K3s API来操作Kubernetes资源。")]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/k3s02.png",alt:"k3s02"}})]),s._v(" "),e("h3",{attrs:{id:"具有外部数据库的高可用k3s-server架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#具有外部数据库的高可用k3s-server架构"}},[s._v("#")]),s._v(" 具有外部数据库的高可用K3s server架构")]),s._v(" "),e("p",[s._v("单个server集群已经可以满足各种使用需求，但是对于重要的环境，需要k3s集群的长时间正常运行，您需要以HA配置运行K3s。")]),s._v(" "),e("p",[s._v("HA K3s集群包括：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("两个或更多server节点；")])]),s._v(" "),e("li",[e("p",[s._v("一个外部数据存储")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/k3s03.png",alt:"k3s03"}})]),s._v(" "),e("h2",{attrs:{id:"k3s-安装部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k3s-安装部署"}},[s._v("#")]),s._v(" k3s 安装部署")]),s._v(" "),e("h3",{attrs:{id:"在线安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在线安装"}},[s._v("#")]),s._v(" 在线安装")]),s._v(" "),e("p",[s._v("此命令安装会同时安装server 端和agent 端。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('\ncurl -sfL https://get.k3s.io | sh -\n\n\n\ncurl -sfL https://get.k3s.io  | INSTALL_K3S_VERSION=v1.17.3 sh -\n\ncurl -sfL https://get.k3s.io | INSTALL_K3S_EXEC_="--docker"  sh -s -\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("查看是否安装好")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\n[root@VM_16_10_centos ~]# kubectl get ns\n\nNAME STATUS AGE\n\ndefault Active 70m\n\nkube-system Active 70m\n\nkube-public Active 70m\n\nkube-node-lease Active 70m\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[e("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/k3s04.png",alt:"k3s04"}})]),s._v(" "),e("h3",{attrs:{id:"离线安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#离线安装"}},[s._v("#")]),s._v(" 离线安装")]),s._v(" "),e("p",[s._v("https://rancher.com/docs/k3s/latest/en/installation/airgap/")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/rancher/k3s/releases",target:"_blank",rel:"noopener noreferrer"}},[s._v("镜像链接"),e("OutboundLink")],1)]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nsudo mkdir -p /var/lib/rancher/k3s/agent/images/\n\nsudo cp ./k3s-airgap-images-$ARCH.tar /var/lib/rancher/k3s/agent/images/\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"k3s-ui"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k3s-ui"}},[s._v("#")]),s._v(" k3s UI")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("kube Dashboard: https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/")])]),s._v(" "),e("li",[e("p",[s._v("dashboard 目前不推荐使用，问题太多，推荐使用rancher。可以将通过导入命令导入到rancher 中。")])])]),s._v(" "),e("h3",{attrs:{id:"k3s-卸载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k3s-卸载"}},[s._v("#")]),s._v(" k3s 卸载")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nk3s-uninstall.sh\n\n会清理掉所欲的k3s 服务和文件。\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"主要目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#主要目录"}},[s._v("#")]),s._v(" 主要目录")]),s._v(" "),e("p",[s._v("rancher 系列产品目录/var/lib/rancher")]),s._v(" "),e("p",[s._v("/var/lib/rancher/k3s/")]),s._v(" "),e("h3",{attrs:{id:"agent注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#agent注册"}},[s._v("#")]),s._v(" agent注册")]),s._v(" "),e("p",[s._v("worker节点通过k3s agent启动时发起的Websocket连接进行注册.")]),s._v(" "),e("p",[s._v("worker节点将使用节点集群密钥以及存储在/etc/rancher/node/password的节点随机密码向server注册。server将在单个节点的/var/lib/rancher/k3s/server/cred/node-passwd路径存储密码，后续任何操作都必须使用相同的密码。如果删除了worker节点目录/etc/rancher/node，则应该为该worker节点重新创建密码文件，或者从服务器中删除该节点。")]),s._v(" "),e("p",[s._v("通过使用该--with-node-id标志启动K3s server或agent，可以将唯一的节点ID添加到hostname。")])])}),[],!1,null,null,null);a.default=t.exports}}]);
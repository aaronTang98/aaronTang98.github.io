(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{521:function(s,n,a){"use strict";a.r(n);var e=a(6),r=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"rancher-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rancher-简介"}},[s._v("#")]),s._v(" rancher 简介")]),s._v(" "),a("p",[s._v("rancher 是全栈化企业级容器应用解决方案")]),s._v(" "),a("p",[s._v("Rancher为容器提供一揽子基础架构服务：CNI兼容的网络服务、存储服务、主机管理、负载均衡、防护墙……")]),s._v(" "),a("p",[s._v("Rancher让上述服务跨越公有云、私有云、虚拟机、物理机环境运行，真正实现一键式应用部署和管理。")]),s._v(" "),a("p",[s._v("Rancher可以与各种CI/CD工具协同工作，可以实现开发、测试、预生产和生产环境的自动部署，提供整体可视化的主机、容器、网络及存储管理，大幅简化运维人员故障排除和生产部署的工作量。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/rancher-1200352.png",alt:"rancher"}})]),s._v(" "),a("h2",{attrs:{id:"基础环境配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础环境配置"}},[s._v("#")]),s._v(" 基础环境配置")]),s._v(" "),a("h3",{attrs:{id:"主机配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机配置"}},[s._v("#")]),s._v(" 主机配置")]),s._v(" "),a("h4",{attrs:{id:"主机名配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机名配置"}},[s._v("#")]),s._v(" 主机名配置")]),s._v(" "),a("p",[s._v("因为K8S的规定，主机名只支持包含 - 和 .(中横线和点)两种特殊符号，并且主机名不能出现重复。")]),s._v(" "),a("ul",[a("li",[s._v("1.Hosts")])]),s._v(" "),a("p",[s._v("配置每台主机的hosts(/etc/hosts),添加host_ip $hostname到/etc/hosts文件中。")]),s._v(" "),a("ul",[a("li",[s._v("2.CentOS关闭selinux")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nsudo sed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("3.关闭防火墙(可选)或者放行相应端口")])]),s._v(" "),a("p",[s._v("对于刚刚接触Rancher的用户，建议在关闭防火墙的测试环境或桌面虚拟机来运行rancher，以避免出现网络通信问题。")]),s._v(" "),a("p",[s._v("​    - 1.关闭防火墙")]),s._v(" "),a("ul",[a("li",[s._v("CentOS")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("systemctl stop firewalld.service && systemctl disable firewalld.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("Ubuntu")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("ufw disable\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("​    - 2.端口放行")]),s._v(" "),a("blockquote",[a("p",[s._v("端口放行请查看端口需求")])]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("PROTOCOL")]),s._v(" "),a("th",[s._v("PORT")]),s._v(" "),a("th",[s._v("DESCRIPTION")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("22")]),s._v(" "),a("td",[s._v("Node driver SSH provisioning")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("2376")]),s._v(" "),a("td",[s._v("Node driver Docker daemon TLS port")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("2379")]),s._v(" "),a("td",[s._v("etcd client requests")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("2380")]),s._v(" "),a("td",[s._v("etcd peer communication")])]),s._v(" "),a("tr",[a("td",[s._v("UDP")]),s._v(" "),a("td",[s._v("8472")]),s._v(" "),a("td",[s._v("Canal/Flannel VXLAN overlay networking")])]),s._v(" "),a("tr",[a("td",[s._v("UDP")]),s._v(" "),a("td",[s._v("4789")]),s._v(" "),a("td",[s._v("Flannel VXLAN overlay networking on Windows cluster")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("9099")]),s._v(" "),a("td",[s._v("Canal/Flannel livenessProbe/readinessProbe")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("6783")]),s._v(" "),a("td",[s._v("Weave Port")])]),s._v(" "),a("tr",[a("td",[s._v("UDP")]),s._v(" "),a("td",[s._v("6783-6784")]),s._v(" "),a("td",[s._v("Weave UDP Ports")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("10250")]),s._v(" "),a("td",[s._v("kubelet API")])]),s._v(" "),a("tr",[a("td",[s._v("TCP")]),s._v(" "),a("td",[s._v("10254")]),s._v(" "),a("td",[s._v("Ingress controller livenessProbe/readinessProbe")])]),s._v(" "),a("tr",[a("td",[s._v("TCP/UDP")]),s._v(" "),a("td",[s._v("30000- 32767")]),s._v(" "),a("td",[s._v("NodePort port range")])])])]),s._v(" "),a("ul",[a("li",[s._v("4.配置主机时间、时区、系统语言")])]),s._v(" "),a("p",[s._v("​    1. 查看时区")]),s._v(" "),a("p",[s._v("​    "),a("code",[s._v("date -R或者timedatectl")])]),s._v(" "),a("p",[s._v("​    2. 修改时区")]),s._v(" "),a("p",[s._v("​    "),a("code",[s._v("ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime")])]),s._v(" "),a("p",[s._v("​    3.修改系统语言环境")]),s._v(" "),a("p",[s._v("​    4. 配置主机NTP时间同步")]),s._v(" "),a("ul",[a("li",[s._v("5.配置主机DNS")])]),s._v(" "),a("p",[s._v("对于类似Ubuntu 18这类默认使用systemd-resolve管理DNS的系统，建议禁用systemd-resolved服务，然后手动配置DNS。")]),s._v(" "),a("p",[s._v("操作方法：")]),s._v(" "),a("p",[s._v("1.禁用systemd-resolved.service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nsystemctl disable systemd-resolved.service\n\nsystemctl stop systemd-resolved.service\n\nrm -rf /etc/resolv.conf ; touch /etc/resolv.conf\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("2.接着编辑/etc/resolv.conf添加DNS服务器")]),s._v(" "),a("p",[s._v("3.重启docker服务")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nsystemctl daemon-reload ; systemctl restart docker\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"kernel性能调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kernel性能调优"}},[s._v("#")]),s._v(" Kernel性能调优")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\ncat >> /etc/sysctl.conf<<EOF\n\nnet.ipv4.ip_forward=1\n\nwatchdog_thresh=30\n\nnet.bridge.bridge-nf-call-iptables=1\n\nnet.ipv4.neigh.default.gc_thresh1=4096\n\nnet.ipv4.neigh.default.gc_thresh2=6144\n\nnet.ipv4.neigh.default.gc_thresh3=8192\n\nEOF\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("数值根据实际环境自行配置，最后执行sysctl -p保存配置")]),s._v(" "),a("h3",{attrs:{id:"docker-安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装配置"}},[s._v("#")]),s._v(" docker 安装配置")]),s._v(" "),a("h4",{attrs:{id:"docker-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-安装"}},[s._v("#")]),s._v(" Docker 安装")]),s._v(" "),a("ul",[a("li",[s._v("修改数据源")])]),s._v(" "),a("p",[s._v("Centos7.x")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum install ca-certificates ;\n\nupdate-ca-trust;\n\n\n\ncp /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo-bak\n\ncat << 'EOF' > /etc/yum.repos.d/CentOS-Base.repo\n\n# CentOS-Base.repo\n\n#\n\n# The mirror system uses the connecting IP address of the client and the\n\n# update status of each mirror to pick mirrors that are updated to and\n\n# geographically close to the client. You should use this for CentOS updates\n\n# unless you are manually picking other mirrors.\n\n#\n\n# If the mirrorlist= does not work for you, as a fall back you can try the \n\n# remarked out baseurl= line instead.\n\n#\n\n#\n\n\n\n[base]\n\nname=CentOS-$releasever - Base - mirrors.aliyun.com\n\nfailovermethod=priority\n\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/os/$basearch/\n\n​        http://mirrors.aliyuncs.com/centos/$releasever/os/$basearch/\n\n​        http://mirrors.cloud.aliyuncs.com/centos/$releasever/os/$basearch/\n\ngpgcheck=1\n\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n\n\n\n#released updates\n\n[updates]\n\nname=CentOS-$releasever - Updates - mirrors.aliyun.com\n\nfailovermethod=priority\n\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/updates/$basearch/\n\n​        http://mirrors.aliyuncs.com/centos/$releasever/updates/$basearch/\n\n​        http://mirrors.cloud.aliyuncs.com/centos/$releasever/updates/$basearch/\n\ngpgcheck=1\n\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n\n\n\n#additional packages that may be useful\n\n[extras]\n\nname=CentOS-$releasever - Extras - mirrors.aliyun.com\n\nfailovermethod=priority\n\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/extras/$basearch/\n\n​        http://mirrors.aliyuncs.com/centos/$releasever/extras/$basearch/\n\n​        http://mirrors.cloud.aliyuncs.com/centos/$releasever/extras/$basearch/\n\ngpgcheck=1\n\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n\n\n\n#additional packages that extend functionality of existing packages\n\n[centosplus]\n\nname=CentOS-$releasever - Plus - mirrors.aliyun.com\n\nfailovermethod=priority\n\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/centosplus/$basearch/\n\n​        http://mirrors.aliyuncs.com/centos/$releasever/centosplus/$basearch/\n\n​        http://mirrors.cloud.aliyuncs.com/centos/$releasever/centosplus/$basearch/\n\ngpgcheck=1\n\nenabled=0\n\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n\n\n\n#contrib - packages by Centos Users\n\n[contrib]\n\nname=CentOS-$releasever - Contrib - mirrors.aliyun.com\n\nfailovermethod=priority\n\nbaseurl=http://mirrors.aliyun.com/centos/$releasever/contrib/$basearch/\n\n​        http://mirrors.aliyuncs.com/centos/$releasever/contrib/$basearch/\n\n​        http://mirrors.cloud.aliyuncs.com/centos/$releasever/contrib/$basearch/\n\ngpgcheck=1\n\nenabled=0\n\ngpgkey=http://mirrors.aliyun.com/centos/RPM-GPG-KEY-CentOS-7\n\n\n\nEOF\n\n\n\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br")])]),a("h4",{attrs:{id:"docker-ce-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-ce-安装"}},[s._v("#")]),s._v(" docker-ce 安装")]),s._v(" "),a("ul",[a("li",[s._v("centos")])]),s._v(" "),a("blockquote",[a("p",[s._v("因为CentOS的安全限制，通过RKE安装K8S集群时候无法使用root账户。所以，建议CentOS用户使用非root用户来运docker,不管是RKE还是custom安装k8s,详情查看无法为主机配置SSH隧道。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n# 定义用户名\n\nNEW_USER=rancher\n\n# 添加用户(可选)\n\nsudo adduser $NEW_USER\n\n# 为新用户设置密码\n\nsudo passwd $NEW_USER\n\n# 为新用户添加sudo权限\n\nsudo echo \"$NEW_USER ALL=(ALL) ALL\" >> /etc/sudoers\n\n# 卸载旧版本Docker软件\n\nsudo yum remove docker \n\n​              docker-client \n\n​              docker-client-latest \n\n​              docker-common \n\n​              docker-latest \n\n​              docker-latest-logrotate \n\n​              docker-logrotate \n\n​              docker-selinux \n\n​              docker-engine-selinux \n\n​              docker-engine \n\n​              container*\n\n# 定义安装版本\n\nexport docker_version=18.06.3\n\n# 对系统进行全面的更新升级，推荐升级一下（可选）\n\nsudo yum update -y;\n\n# 安装必要的一些系统工具\n\nsudo yum install -y yum-utils device-mapper-persistent-data \n\n​    lvm2 bash-completion;\n\n# Step 2: 添加软件源信息\n\nsudo yum-config-manager --add-repo \n\n​    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo;\n\n# Step 3: 更新并安装 Docker-CE\n\nsudo yum makecache all;\n\nversion=$(yum list docker-ce.x86_64 --showduplicates | sort -r|grep ${docker_version}|awk '{print $2}');\n\nsudo yum -y install --setopt=obsoletes=0 docker-ce-${version} docker-ce-selinux-${version};\n\n# 如果已经安装高版本Docker,可进行降级安装(可选)\n\nyum downgrade --setopt=obsoletes=0 -y docker-ce-${version} docker-ce-selinux-${version};\n\n# 把当前用户加入docker组\n\nsudo usermod -aG docker $NEW_USER;\n\n# 设置开机启动\n\nsudo systemctl enable docker;\n\n\n\n\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br")])]),a("blockquote",[a("p",[s._v("Docker-engine")])]),s._v(" "),a("p",[s._v("Docker-Engine Docker官方已经不推荐使用，请安装Docker-CE。")]),s._v(" "),a("h4",{attrs:{id:"锁定docker-版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁定docker-版本"}},[s._v("#")]),s._v(" 锁定docker 版本")]),s._v(" "),a("p",[s._v("可能因为某些原因无意间执行了yum update或者apt-get -y upgrade;导致Docker版本升级。为了避免此类问题发生，建议在安装好Docker后对Docker软件进行锁定，防止Docker意外更新。")]),s._v(" "),a("ul",[a("li",[s._v("centos")])]),s._v(" "),a("ol",[a("li",[s._v("安装yum-plugin-versionlock插件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum install yum-plugin-versionlock\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("锁定软件包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum versionlock add docker-ce docker-ce-cli\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n[root@izwz969o7lu6t9lh4ta6m5z ~]# yum versionlock add docker-ce docker-ce-cli\n\n已加载插件：fastestmirror, versionlock\n\nAdding versionlock on: 0:docker-ce-17.06.2.ce-3.el7.centos\n\nversionlock added: 1\n\n[root@izwz969o7lu6t9lh4ta6m5z ~]#\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("查看已锁定的软件包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum versionlock list\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("解锁指定的软件包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum versionlock delete <软件包名称>\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("解锁所有的软件包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\nyum versionlock clear\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"docker配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker配置"}},[s._v("#")]),s._v(" docker配置")]),s._v(" "),a("p",[s._v("对于通过systemd来管理服务的系统(比如CentOS7.X、Ubuntu16.X), Docker有两处可以配置参数: 一个是docker.service服务配置文件,一个是Docker daemon配置文件daemon.json。")]),s._v(" "),a("p",[s._v("1.docker.service")]),s._v(" "),a("p",[s._v("对于CentOS系统，docker.service默认位于/usr/lib/systemd/system/docker.service；对于Ubuntu系统，docker.service默认位于/lib/systemd/system/docker.service")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("daemon.json")])]),s._v(" "),a("p",[s._v("daemon.json默认位于/etc/docker/daemon.json，如果没有可手动创建，基于systemd管理的系统都是相同的路径。通过修改daemon.json来改过Docker配置，也是Docker官方推荐的方法。")]),s._v(" "),a("blockquote",[a("p",[s._v("以下说明均基于systemd,并通过/etc/docker/daemon.json来修改配置。")])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("配置镜像下载和上传并发数")])]),s._v(" "),a("p",[s._v('从Docker1.12开始，支持自定义下载和上传镜像的并发数，默认值上传为3个并发，下载为5个并发。通过添加"max-concurrent-downloads"和"max-concurrent-uploads"参数对其修改:')]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n"max-concurrent-downloads": 3,\n\n"max-concurrent-uploads": 5\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("配置镜像加速地址")])]),s._v(" "),a("p",[s._v("Rancher从v1.6.15开始到v2.x.x,Rancher系统相关的所有镜像(包括1.6.x上的K8S镜像)都托管在Dockerhub仓库。Dockerhub节点在国外，国内直接拉取镜像会有些缓慢。为了加速镜像的下载，可以给Docker配置国内的镜像地址。")]),s._v(" "),a("p",[s._v("编辑/etc/docker/daemon.json加入以下内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n{\n\n"registry-mirrors": ["https://XXXX.mirror.aliyuncs.com/","https://IP:PORT/"]\n\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("可以设置多个registry-mirrors地址，以数组形式书写，地址需要添加协议头(https或者http)。")])]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("配置insecure-registries\b私有仓库")])]),s._v(" "),a("p",[s._v("Docker默认只信任TLS加密的仓库地址(https)，所有非https仓库默认无法登陆也无法拉取镜像。insecure-registries字面意思为不安全的仓库，通过添加这个参数对非https仓库进行授信。可以设置多个insecure-registries地址，以数组形式书写，地址不能添加协议头(http)。")]),s._v(" "),a("p",[s._v("编辑/etc/docker/daemon.json加入以下内容:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n{\n\n"insecure-registries": ["192.168.1.100","IP:PORT"]\n\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("配置Docker存储驱动")])]),s._v(" "),a("p",[s._v("OverlayFS是一个新一代的联合文件系统，类似于AUFS，但速度更快，实现更简单。Docker为OverlayFS提供了两个存储驱动程序:旧版的overlay，新版的overlay2(更稳定)。")]),s._v(" "),a("p",[s._v("先决条件:")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("overlay2: Linux内核版本4.0或更高版本，或使用内核版本3.10.0-514+的RHEL或 CentOS。")])]),s._v(" "),a("li",[a("p",[s._v("overlay: 主机Linux内核版本3.18+")])]),s._v(" "),a("li",[a("p",[s._v("支持的磁盘文件系统")])])]),s._v(" "),a("p",[s._v("​    - ext4(仅限RHEL 7.1)")]),s._v(" "),a("p",[s._v("​    - xfs(RHEL7.2及更高版本)，需要启用d_type=true。")]),s._v(" "),a("blockquote",[a("p",[s._v("具体详情参考 Docker Use the OverlayFS storage driver")])]),s._v(" "),a("p",[s._v("编辑/etc/docker/daemon.json加入以下内容")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n{\n\n"storage-driver": "overlay2",\n\n"storage-opts": ["overlay2.override_kernel_check=true"]\n\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("7.配置日志驱动")]),s._v(" "),a("p",[s._v("容器在运行时会产生大量日志文件，很容易占满磁盘空间。通过配置日志驱动来限制文件大小与文件的数量。")]),s._v(" "),a("p",[s._v("限制单个日志文件为100M,最多产生3个日志文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('\n{\n\n"log-driver": "json-file",\n\n"log-opts": {\n\n​    "max-size": "100m",\n\n​    "max-file": "3"\n\n​    }\n\n}\n\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("8.UbuntuDebian系统 ，docker info提示WARNING: No swap limit support")]),s._v(" "),a("p",[s._v("UbuntuDebian系统下，默认cgroups未开启swap account功能，这样会导致设置容器内存或者swap资源限制不生效。可以通过以下命令解决:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\n# 统一网卡名称为ethx\n\nsudo sed -i 's/en[[:alnum:]]*/eth0/g' /etc/network/interfaces;\n\nsudo sed -i 's/GRUB_CMDLINE_LINUX=\"(.*)\"/GRUB_CMDLINE_LINUX=\"net.ifnames=0 cgroup_enable=memory swapaccount=1 biosdevname=0 1\"/g' /etc/default/grub;\n\nsudo update-grub;\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("blockquote",[a("p",[s._v("注意 通过以上命令可自动配置参数，如果/etc/default/grub非默认配置，需根据实际参数做调整。 提示 以上配置完成后，建议重启一次主机。")])]),s._v(" "),a("h2",{attrs:{id:"rancher-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rancher-安装"}},[s._v("#")]),s._v(" rancher 安装")]),s._v(" "),a("h3",{attrs:{id:"单节点在线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单节点在线安装"}},[s._v("#")]),s._v(" 单节点在线安装")]),s._v(" "),a("h4",{attrs:{id:"配置ssl-证书并安装rancher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置ssl-证书并安装rancher"}},[s._v("#")]),s._v(" 配置ssl 证书并安装rancher")]),s._v(" "),a("p",[s._v("出于安全考虑，使用Rancher时需要SSL进行加密。SSL可以保护所有Rancher网络通信，例如登录或与集群交互。")]),s._v(" "),a("ol",[a("li",[s._v("方案A-使用默认自签名证书")])]),s._v(" "),a("p",[s._v("默认情况下，Rancher会自动生成一个用于加密的自签名证书。从您的Linux主机运行Docker命令来安装Rancher，而不需要任何其他参数:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\ndocker run -d --restart=unless-stopped \n\n-p 80:80 -p 443:443 \n\n-v <主机路径>:/var/lib/rancher/ \n\n-v /root/var/log/auditlog:/var/log/auditlog \n\n-e CATTLE_SYSTEM_CATALOG=bundled \n\n-e AUDIT_LEVEL=3 \n\nrancher/rancher:stable (或者rancher/rancher:latest)\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("方案B-使用您自己的自签名证书")])]),s._v(" "),a("p",[s._v("Rancher安装可以使用自己生成的自签名证书，如果没有自签名证书，可一键生成自签名ssl证书。")]),s._v(" "),a("blockquote",[a("p",[s._v("提示")])]),s._v(" "),a("p",[s._v("使用OpenSSL或其他方法创建自签名证书。")]),s._v(" "),a("p",[s._v("这里的证书不需要进行base64加密。")]),s._v(" "),a("p",[s._v("证书文件必须是PEM格式。")]),s._v(" "),a("p",[s._v("在您的证书文件中，包含链中的所有中间证书。有关示例，请参考SSL常见问题/故障排除。")]),s._v(" "),a("p",[s._v("您的Rancher安装可以使用您提供的自签名证书来加密通信。创建证书后，运行docker命令时把证书文件映射到容器中。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\ndocker run -d --restart=unless-stopped \n\n  -p 80:80 -p 443:443 \n\n  -v <主机路径>:/var/lib/rancher/ \n\n  -v /var/log/rancher/auditlog:/var/log/auditlog \n\n  -e AUDIT_LEVEL=3 \n\n  -v /etc/<CERT_DIRECTORY>/tls.crt:/etc/rancher/ssl/cert.pem \n\n  -v /etc/<CERT_DIRECTORY>/tls.key:/etc/rancher/ssl/key.pem \n\n  -v /etc/<CERT_DIRECTORY>/cacerts.pem:/etc/rancher/ssl/cacerts.pem \n\n  rancher/rancher:stable (或者rancher/rancher:latest)\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("方案C-使用权威CA机构颁发的证书")])]),s._v(" "),a("p",[s._v("如果您公开发布您的应用，理想情况下应该使用由权威CA机构颁发的证书。")]),s._v(" "),a("blockquote",[a("p",[s._v("提示")])]),s._v(" "),a("p",[s._v("证书必须是PEM格式,PEM只是一种证书类型，并不是说文件必须是PEM为后缀，具体可以查看证书类型。")]),s._v(" "),a("p",[s._v("确保容器包含您的证书文件和密钥文件。由于您的证书是由认可的CA签署的，因此不需要安装额外的CA证书文件。")]),s._v(" "),a("p",[s._v("给容器添加--no-cacerts参数禁止Rancher生成默认CA证书。")]),s._v(" "),a("p",[s._v("这里的证书不需要进行base64加密。")]),s._v(" "),a("p",[s._v("获取证书后，运行Docker命令以部署Rancher，同时指向证书文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("\ndocker run -d --restart=unless-stopped \n\n  -p 80:80 -p 443:443 \n\n  -v <主机路径>:/var/lib/rancher/ \n\n  -v /root/var/log/auditlog:/var/log/auditlog \n\n  -e CATTLE_SYSTEM_CATALOG=bundled \n\n  -e AUDIT_LEVEL=3 \n\n  -v /etc/<CERT_DIRECTORY>/tls.crt:/etc/rancher/ssl/cert.pem \n\n  -v /etc/<CERT_DIRECTORY>/tls.key:/etc/rancher/ssl/key.pem \n\n  rancher/rancher:stable (或者rancher/rancher:latest) --no-cacerts\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://docs.rancher.cn/rancher2x/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考rancher官方文档"),a("OutboundLink")],1)])])}),[],!1,null,null,null);n.default=r.exports}}]);
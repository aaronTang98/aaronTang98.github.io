(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{526:function(a,s,n){"use strict";n.r(s);var r=n(6),t=Object(r.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"_1、获取-postgresql-的镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、获取-postgresql-的镜像"}},[a._v("#")]),a._v(" 1、获取 postgresql 的镜像")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("  docker pull postgres\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h2",{attrs:{id:"_2、启动-postgresql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、启动-postgresql"}},[a._v("#")]),a._v(" 2、启动 postgresql")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\nmkdir -p /data/postgresql/data\n\nmkdir -p /var/lib/postgresql\n\nln -s /data/postgresql/data/ /var/lib/postgresql/data\n\ndocker run --name postgresqlDB -p 5432:5432 -e POSTGRES_USER=sonar -e POSTGRES_PASSWORD=sonar -e POSTGRE_DB=sonar -v /data/postgresql/data:/var/lib/postgresql/data -d postgres\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br")])]),n("h2",{attrs:{id:"_3、获取-sonarqube-的镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、获取-sonarqube-的镜像"}},[a._v("#")]),a._v(" 3、获取 sonarqube 的镜像")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("docker pull sonarqube:lts \n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("h2",{attrs:{id:"_4、启动-sonarqube"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、启动-sonarqube"}},[a._v("#")]),a._v(" 4、启动 sonarqube")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\nmkdir -p /data/sonarqube/data\n\nmkdir -p /data/sonarqube/extensions\n\nchmod -R 777 /data/sonarqube/\n\nchmod -R 777 /opt/sonarqube/\n\nln -s /data/sonarqube /opt/sonarqube\n\nmkdir -p /opt/sonarqube/extensions/plugins\n\ndocker run --name sonarqube --link postgresql -e SONARQUBE_JDBC_URL=jdbc:postgresql://postgresqlDB:5432/sonar -p 9000:9000 -d -v /data/sonarqube/data:/opt/sonarqube/data -v /data/sonarqube/extensions:/opt/sonarqube/extensions sonarqube\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br")])]),n("h2",{attrs:{id:"_5、代码质量检验sonar平台"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、代码质量检验sonar平台"}},[a._v("#")]),a._v(" 5、代码质量检验sonar平台")]),a._v(" "),n("p",[a._v('1.打开 http://localhost:9000/ , 点击 "Log in"')]),a._v(" "),n("blockquote",[n("p",[a._v("登录账号：admin 密码：admin")])]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube01-1202784.jpg",alt:"sonarqube01"}})]),a._v(" "),n("h2",{attrs:{id:"_6、初始状态确认"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6、初始状态确认"}},[a._v("#")]),a._v(" 6、初始状态确认")]),a._v(" "),n("p",[a._v("检查sonar  缺省的Java等语言的Sonar Way是否存在，详细如下图所示")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube02-1202877.jpg",alt:"sonarqube02"}})]),a._v(" "),n("p",[a._v("关键是quality profile页面中，缺少quality profile。")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube03-1202906.jpg",alt:"sonarqube03"}})]),a._v(" "),n("p",[a._v("安装语言插件")]),a._v(" "),n("p",[a._v("由于本文是使用typescript的Angular应用，安装SonarTS和SonarJS即可。而SonarJS安装时也会顺便带上SonarTS，所以只需要安装SonarJS即可。")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube04-1202922.jpg",alt:"sonarqube04"}})]),a._v(" "),n("p",[a._v("安装完毕之后，可以看到SonarTS也已经被安装了。")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube05-1202937.jpg",alt:"sonarqube05"}})]),a._v(" "),n("p",[a._v("另外同时安装一下Java语言的插件")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube06-1202950.jpg",alt:"sonarqube06"}})]),a._v(" "),n("p",[a._v("使用界面方式安装，SonarQube也是将此jar文件放至extensions目录下，具体来说分如下步骤：")]),a._v(" "),n("p",[a._v("步骤1: 下载开始后，jar文件会保存在downloads目录下，jar文件在下载中的状态：会形成sonar-*.jar.tmp文件。")]),a._v(" "),n("p",[a._v("步骤2: 下载完毕之后，会自动将downloads目录下的.tmp后缀删除")]),a._v(" "),n("p",[a._v("本文示例的SonarTS、SonarJS和SonarJava的安装，实际上对应了三个文件，直接以jar文件结尾的表明已经下载完毕，否则还会带有.tmp后缀。下载的中间状态如下所示")]),a._v(" "),n("p",[a._v("liumiaocn:extensions liumiao$ tree .")]),a._v(" "),n("p",[a._v(".")]),a._v(" "),n("p",[a._v("├── downloads")]),a._v(" "),n("p",[a._v("│ ├── sonar-java-plugin-5.14.0.18788.jar.tmp")]),a._v(" "),n("p",[a._v("│ ├── sonar-javascript-plugin-6.1.0.11503.jar.tmp")]),a._v(" "),n("p",[a._v("│ └── sonar-typescript-plugin-2.1.0.4359.jar")]),a._v(" "),n("p",[a._v("└── plugins")]),a._v(" "),n("p",[a._v("2 directories, 3 files")]),a._v(" "),n("p",[a._v("liumiaocn:extensions liumiao$")]),a._v(" "),n("p",[a._v("如果下载时速度不好的情况下，此时会显示非常之慢，查看日志又往往没有任何提示，此时可以通过查看一下中间文件的大小来进行确认是否仍在正常执行")]),a._v(" "),n("p",[a._v("此时再确认SonarQube的页面，就会发现已经成功了")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube07-1202965.jpg",alt:"sonarqube07"}})]),a._v(" "),n("p",[a._v("点击Restart Server进行重启, 以管理员身份登录，可以确认到quality profile已经添加了三种语言的Sonar way规则。实际本文示例只是用到一种。")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube08-1202980.jpg",alt:"sonarqube08"}})]),a._v(" "),n("h2",{attrs:{id:"_7、安装中文插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7、安装中文插件"}},[a._v("#")]),a._v(" 7、安装中文插件")]),a._v(" "),n("p",[a._v("进入github： https://github.com/SonarQubeCommunity/sonar-l10n-zh")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube09-1203014.jpg",alt:"sonarqube09"}})]),a._v(" "),n("p",[a._v("查看兼容的列表")]),a._v(" "),n("p",[a._v("SonarQube7.9 对应的是sonar-l10n-zh 1.29")]),a._v(" "),n("p",[a._v("进入https://github.com/SonarQubeCommunity/sonar-l10n-zh/releases 下载1.29 的版本")]),a._v(" "),n("p",[a._v("然后将sonar-l10n-zh-plugin-1.29.jar 上传到/opt/sonarqube/extensions/plugins 目录下。重启后，中文插件就可以生效了。")]),a._v(" "),n("h2",{attrs:{id:"_8、以-maven-项目为例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8、以-maven-项目为例"}},[a._v("#")]),a._v(" 8、以 Maven 项目为例，")]),a._v(" "),n("p",[a._v("Maven 项目")]),a._v(" "),n("p",[a._v("pom.xml 添加配置：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\n​    \x3c!-- 代码质量检测 --\x3e\n\n​    <profiles>\n\n​        <profile>\n\n​            <id>sonar</id>\n\n​            <activation>\n\n​                <activeByDefault>true</activeByDefault>\n\n​            </activation>\n\n​            <properties>\n\n​                <sonar.host.url>http://127.0.0.1:9000/</sonar.host.url>\n\n​            </properties>\n\n​        </profile>\n\n​    </profiles>\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br")])]),n("h3",{attrs:{id:"_8-1执行命令-检测代码质量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-1执行命令-检测代码质量"}},[a._v("#")]),a._v(" 8.1执行命令，检测代码质量")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\n$ mvn sonar:sonar\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h3",{attrs:{id:"_8-2-成功之后-返回到浏览器-就可以浏览自己的项目的代码质量了"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-成功之后-返回到浏览器-就可以浏览自己的项目的代码质量了"}},[a._v("#")]),a._v(" 8.2 成功之后，返回到浏览器，就可以浏览自己的项目的代码质量了")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube10-1203037.jpg",alt:"sonarqube10"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube11-1203065.jpg",alt:"sonarqube11"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube12-1203078.jpg",alt:"sonarqube12"}})]),a._v(" "),n("p",[a._v("目前码云上代码分析工具首推的也是 sonarqube，支持各种语言的程序检测，使用简单方便，感觉非常适合微服务的代码评审，强烈推荐。")]),a._v(" "),n("h2",{attrs:{id:"_9、idea配置sonar步骤如下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9、idea配置sonar步骤如下"}},[a._v("#")]),a._v(" 9、idea配置sonar步骤如下：")]),a._v(" "),n("h3",{attrs:{id:"_9-1-安装sonar插件-如果安装失败就多安装几次-博主就是安装了两次-第一次安装失败了-第二次才安装成功的。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-安装sonar插件-如果安装失败就多安装几次-博主就是安装了两次-第一次安装失败了-第二次才安装成功的。"}},[a._v("#")]),a._v(" 9.1 安装sonar插件，如果安装失败就多安装几次，博主就是安装了两次，第一次安装失败了，第二次才安装成功的。")]),a._v(" "),n("p",[a._v("安装成功后重启idea")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube13-1203106.jpg",alt:"sonarqube13"}})]),a._v(" "),n("h3",{attrs:{id:"_9-2-添加sonar服务器连接"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-添加sonar服务器连接"}},[a._v("#")]),a._v(" 9.2 添加sonar服务器连接")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube14-1203122.jpg",alt:"sonarqube14"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube15-1203136.jpg",alt:"sonarqube15"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube16-1203148.jpg",alt:"sonarqube16"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube17-1203161.jpg",alt:"sonarqube17"}})]),a._v(" "),n("h3",{attrs:{id:"_9-3-选择项目对应的规则"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-选择项目对应的规则"}},[a._v("#")]),a._v(" 9.3 选择项目对应的规则")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube18-1203178.jpg",alt:"sonarqube18"}})]),a._v(" "),n("p",[a._v("点击OK之后则配置完成")]),a._v(" "),n("h3",{attrs:{id:"_9-4-idea下方会出现sonarlint选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-idea下方会出现sonarlint选项"}},[a._v("#")]),a._v(" 9.4 idea下方会出现SonarLint选项")]),a._v(" "),n("p",[a._v("mvn sonar:sonar")]),a._v(" "),n("p",[a._v("-Dsonar.projectKey=project")]),a._v(" "),n("p",[a._v("-Dsonar.host.url=http://ip:9000")]),a._v(" "),n("p",[a._v("-Dsonar.login=6c0344dbbf9aa168c6f9b2dde3371108dcba9269")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube19-1203206.jpg",alt:"sonarqube19"}})]),a._v(" "),n("h3",{attrs:{id:"_9-5-打开一个文件点击运行按钮-则最该代码进行扫描-会自动显示扫描的问题-双击问题则会定位到相应的代码。"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-5-打开一个文件点击运行按钮-则最该代码进行扫描-会自动显示扫描的问题-双击问题则会定位到相应的代码。"}},[a._v("#")]),a._v(" 9.5 打开一个文件点击运行按钮，则最该代码进行扫描，会自动显示扫描的问题，双击问题则会定位到相应的代码。")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube20-1203217.jpg",alt:"sonarqube20"}})]),a._v(" "),n("h2",{attrs:{id:"_10、安装错误记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10、安装错误记录"}},[a._v("#")]),a._v(" 10、安装错误记录")]),a._v(" "),n("ul",[n("li",[a._v("错误描述：")])]),a._v(" "),n("p",[a._v("ERROR: [1] bootstrap checks failed [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]")]),a._v(" "),n("p",[n("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/aaronTang98/image_store/blog/sonarqube21-1203230.jpg",alt:"sonarqube21"}})]),a._v(" "),n("ul",[n("li",[a._v("解决办法：")])]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\nvi /etc/sysctl.conf \n\nvm.max_map_count=655360\n\nsysctl -p\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);